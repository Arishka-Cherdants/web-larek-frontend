# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды!

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
---



--- 

### Описание базовых интерфейсов и типов

### Интерфейс карточки товара 

```
interface IProduct {
    category: string; 
    title: string; 
    description: string;
    price: number | null;
    id: string;
    image: string
}
```


### Интерфейс модели данных приложения 

```
 interface IAppState {
    basket: string[];
	catalog: ICard[];
	order: IOrder | null;
	preview: string | null
}
```


### Интерфейс отображения корзины 

```
interface IBasketView {
	basketItems: HTMLElement[];
	total: number;
	selected: string[];
}
```


### Интерфейс данных формы для оформления заказа

```
interface IOrderForm {
  pay: string;
  adres: string;
  email: string;
  phone: string;
  totalPrice: string | number;
}
```


### Интерфейс данных заказа

```
interface IOrder extends IOrderForm {
  items: string[];
}
```


### Интерфейс оформленного заказа

```
interface IOrderResult {
  id: string;
}
```

### Тип данных товара, при подробном просмотре карточки продукта
```
type TPreviewItem = Pick<IProduct, 'category' | 'title' | 'description' | 'price' | 'id' | 'image'>;
```

### Тип для карточек продуктов, находящихся в корзине
```
type TBasketItem = Pick<IProduct, 'title' | 'price' | 'id'>;
```

### Тип формы для оплаты заказа
```
type TPayForm = Pick<IOrderForm, 'pay' | 'adres'>;
```

### Тип формы для контактных данных пользоваетля 
```
type TContactsForm = Pick<IOrderForm, 'email' | 'phone'>;
```

### Тип ошибки оформлени заказа
```
type FormErrors = Partial<Record<keyof IOrder, string>>;
```

## Архитектура приложения

потсроена по принципу MVP

классы модели полготавливают данные для отображения 

классы отображения только показывают изменённые данные, которые этому классу предоставляются

классы презентера, являются посредниками между представлением и моделью


### Класс Api

Данный класс создан для полей и основных методов, которые необходимы для работы с сервером.
(запросы GET и POST)

Конструктор класса: (передаются базовый URL и опции запроса)
- **`constructor(baseUrl: string, options: RequestInit = {})`**

Методы: 

- **`get`**: Выполняет GET запрос 
- **`post`**: Выполняет POST запрос
- **`handleResponce`**: Обрабатывает ответ от сервера


#### Класс EventEmitter

Брокер событий. Отвечает за подписку на событие. Управляет событимиЮ возникащими вследствие дейтвий пользователя. 

Свойства: 

- **`_events`**:  Хранит все заерегстрированные обработчики событий. (клиючи - имена событий(строки), значения - это подписчики )

Методы: 

- **`on`**: Подписка на обытие заинтерисованных обработчиков

- **`off`**: Снимает обработчик с события

- **`emit`**: Вызывает подписанный обработчик

- **`onAll`**: Слушает все события

- **`offAll`**: Сбрасывает все обработчики

- **`trigger`**: Создаёт колбэк-триггер, генерирующий событие при вызове


## Слой Model (Модель данных, слой, который работает только с данными приложения)


### Класс Model

Абстрактный класс дженерик. Служит базой и централизацией для логики работы

Методы:

- **`emitChanges`**: регистрирует событие с входящим именем и передаёт данные


#### Класс AppState

Расширяет класс Model<T>, интерфейс IAppState. Содержит основные данные со стрницы и методы для работы с этими данными. 

Свойства:

- **`catalog`**: данные каталога продуктов (товаров)

- **`basket`**: данные корзины продутов (товаров)

- **`preview`**: данные товара выбранного для подробного просмотра 

- **`order`**: данные для оформления заказа

- **`errorsForm`**: данные ошибки формы


Методы:

- **`setCatalog`**: задаёт каталог продуктов 

- **`addProdBasket`**: добавление продукта в корзину

- **`removeProdBasket`**: удаляет конкретный продукт из корзины

- **`clearFulBasket`**: полностью очищает корзину

- **`getAllProdsBasket`**: получение данных продуктов, находящихся в корзине

- **`setPreview`**: выбрать продукт для подробного просмотра 

- **`getProdButton`**: получает состояние кнопки продукта 

- **`updateOrder`**: обновление данных заказа

- **`getTotalPrice`**: получить полную сумму заказа

- **`clearOrder`**: очистить данне заказа

- **`setOrder`**: задаёт жанные формы заказа

- **`setContacts`**: задаёт данные формы контактов 

- **`validateOrder`**: валидация формы с данными заказа

- **`validateContacts`**: валижация формы с контактными данными покупателя


## Слой View (отображение )

#### Класс Component

Абстрактный класс дженерик. Содержит в себе основные методы для работы с элементами отображеня

Свойства:

- **`container`**: для элемента (HTMLElement) являющегося контейнером для отображения

Методы:

- **`toggleClass`**: переключение классов элемента

- **`setTextContent`**: задаёт текст элементу

- **`toggleDisabled`**: переключает состояние блокировки

- **`setHidden`**: скрыть

- **`setVisible`**: показать скрытый

- **`setImage`**: задать изображение

- **`render`**: вызывается, когда надо обновить/ввести данные в атрибуты элементов


#### Класс Page

Отвчает за отоброжение всех данных на странице, таких как каталог продуктов, корзина, счётчик продуктов в корзине

Свойства:

- **`_wrapper`**: разметка - обёртка страницы

- **`_catalog`**: хранение разметки каталога продуктов

- **`_basketButton`**: кнопа корзины

- **`_counter`**: элемент счётчика корзины

Методы:

- **`setLocked`**: состояние блокирови страницы 

- **`setCatalog`**: задание каталога продуктов

- **`setСounter`**: задание значения счётчика корзины


#### Класс Card

Карточка продукта, отображаемая на странице (имеет 3 шаблона). Интерфес ICrad

Свойтсва:

- **`_id`**: id товара

- **`_title`**: название продукта

- **`_description`**: описание продукта

- **`_image`**: изображение продукта

- **`_category`**: категория продукта

- **`_price`**: цена продукта

- **`_button`**: кнопка продукта (купить/удалить)

- **`_basketItemIndex`**: порядковый номер продукта

Методы:

- **`set id`**: задаёт id крточки продутка

- **`get id`**: возвращает id крточки продутка

- **`set title`**: задаёт заголовок карточки продукта

- **`get title`**: возвращает заголовок карточки проудкта

- **`set description`**: задаёт описаение продукта карточки

- **`set image`**: задаёт изображене продутка

- **`set category`**: задаёт категорию продутка

- **`set price`**: задаёт цену товара

- **`get prace`**: возвращает цену товара

- **`set button`**: задаёт текст для кнопки

- **`set basketItemIndex`**: задаёт порядковый номер продукта в корзине


#### Класс Basket

Отвечает за отображение корзины выбранных проудктов

Своства:

- **`_list`**: разметка контейнера списка продуктов

- **`_totalPrice`**: раметка эелемента стоимости всемх проудктов

- **`_buttonInBasket`**: кнопка "оформить"

Методы:

- **`set list`**: задаёт список продуктов, наодящихся в корзине

- **`set totalPrice`**: задаёт стоимость всех продуктов, находящихся в корзине

- **`set buttonState`**: задаёт состояние кнопки "оформить"


#### Класс Modal

Отвечает за отображение содержимого модального окна.

- **`constructor(container: HTMLElement, events: IEvents)`**: конструктор принимает контейнер модального окна и событие для его инициализации


Свойства:

- **`container`**: хранение разметки модального окна

- **`events`**: брокер событий 

Методы: 

- **`set content`**: задаёт содержимое модальному окну

- **`open`**: управление отображением модального окна (открыть)

- **`close`**: управление отображением модального окна (закрыть)


### Классс Order

Отвечает за модальное окно оформление заказа с его оплатой. (Первое)

Свойства:

- **`buttonOnline`**: выбор оплаты онлайн

- **`buttonReceived`**: выбор оплаты при получении

- **`inputAdres`**: поле ввода адреса

Методы:

- **`set pay`**: задаёт значение способа оплаты

- **`set adres`**: задаёт значение адреса доставки


### Класс Contacts

Отвечает за модальное окно оформление заказа с кнтастными данными покупателя. (Второе)

Свойства:

- **`inputEmail`**: поле для ввода почты

- **`inputPhone`**: поле для ввода номера телефона

Методы:

- **`set email`**: задаёт значение почты

- **`set phone`**: задаёт значение номера телефона


### Класс Success

Отвечает за отоброжение успешно оформленного заказа

Свойства:

- **`_totalPrice`**: элемент разметки с итоговой суммой заказа

- **`_close`**: разметка кнопки закрытия модального окна

Методы:

- **`set totalPrice`**: задаёт итоговую стоимость заказа

## Слой Presenter (презентер) (посредник во взаимодйствии Model и View)

### Класс LarekApi

Отвечает за работу с сервером. Расширяет класс Api

Методы:

- **`getPdoducts`**: получение списка данных всех продуктов

- **`sendOrder`**: отправка данных заказа

## Взаимодействие компонентов

Основная логика взаимодействия между слоями приложения реализована в файле `index.ts`

Общение между всеми частями приложения проиходит через события. Вначале создаются основные объекты, затем настраиваются правила обработки событий,прописываются реакции на события 

События, которые возниают в результате действий пользователя. 
Генерируемые события:

- **`catalogProd:changed`** изменения каталога продуктов
- **`product:select`** выбор продутка для подробного просмотра
- **`preview:changed`** изменение данных о продукте в модальном окне
- **`product:add`** добавить продукт в корзину
- **`product:remove`** удалить продукт из корзины
- **`basket:changed`** изменение корзины
- **`modal:open`** открытие модального окна
- **`modal:close`** закрытие модального окна
- **`order:open'`** открытие формы оформления заказа
- **`order:submit`** сохранение данных о заказе в форме
- **`contacts:submit`** сохранение контактных данных пользователя в форме
- **`order:ready`** событие после валидация формы заказа
- **`contacts:ready`** событие после валидация контактных данных пользователя в форме
- **`basketButOrder`** подтверждение покупки в корзине
- **`order:change`** изменение данных формы оформления заказа
- **`contacts:change`** изменение контактных данных пользователя в форме